<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
		*{
			margin:0;
			padding:0;
		}
		#blessing{
			width: 900px;
			margin: 0 auto;
			margin-top: 20px;
			padding:10px;
			border:1px solid #ccc;
			border-radius: 5px;
			box-shadow:0 0 6px #ccc;
			line-height: 22px;
		}
		#main{
			position:relative;
		}
		.pic{
			padding:15px 0 0 15px;
			float:left;
		}
		.box{
			padding:10px;
			border:1px solid #ccc;
			border-radius: 5px;
			box-shadow:0 0 6px #ccc;
		}
		.box img{
			width:162px;
			height:auto;
		}
	</style>
	<script type="text/javascript">
		window.onload=function(){
			waterfall('main','pic');
			var dataInt={'data':[{'src':'1.jpg'},{'src':'2.jpg'},{'src':'3.jpg'},{'src':'4.jpg'},{'src':'5.jpg'},{'src':'6.jpg'},{'src':'7.jpg'},{'src':'8.jpg'},{'src':'9.jpg'},{'src':'10.jpg'}]};
			window.onscroll=function(){
				if(checkscrollside()){
				var _main=document.getElementById('main');
				for(var i=0;i<dataInt.data.length;i++){
					var _pic=document.createElement('div');
					_pic.className='pic';
					_main.appendChild(_pic);
					var _box=document.createElement('div');
					_box.className='box';
					_pic.appendChild(_box);
					var _img=document.createElement('img');
					_img.src='./images/'+dataInt.data[i].src;
					_box.appendChild(_img);
				}
				waterfall('main','pic');
			};
		}
	}

		function waterfall(parent,pic){
			var _parent=document.getElementById(parent);
			var _pic=getClassObj(_parent,pic);
			var picW=_pic[0].offsetWidth;
			var num=Math.floor(document.documentElement.clientWidth/picW);
			_parent.style.cssText='width:'+picW*num+'px;margin:0 auto;';

			var picHArr=[];//存储每列中所有块高相加
			for(var i=0;i<_pic.length;i++){
				var picH=_pic[i].offsetHeight;
				if(i<num){
					picHArr[i]=picH;
				}else{
					var minH=Math.min.apply(null,picHArr);
					var minHindex=getminHIndex(picHArr,minH);
					_pic[i].style.position='absolute';
					_pic[i].style.top=minH+'px';
					_pic[i].style.left=_pic[minHindex].offsetLeft+'px';
					picHArr[minHindex]+=_pic[i].offsetHeight;
				}
			}
		}
   
		function getClassObj(parent,className){
			var obj=parent.getElementsByTagName('*');
			var pics=[];
			for(var i=0;i<obj.length;i++){
				if(obj[i].className==className){
					pics.push(obj[i]);
				}
			};
			return pics;
		}
		function getminHIndex(picHArr,minH){
			for(var i in picHArr){
				if(picHArr[i]==minH){
					return i;
				}
			}
		}
		function checkscrollside(){
			var _parent=document.getElementById('main');
			var _pic=getClassObj(_parent,'pic');
			var lastPinH=_pic[_pic.length-1].offsetTop+Math.floor(_pic[_pic.length-1].offsetHeight/2);//创建【触发添加块框函数waterfall()】的高度：最后一个块框的距离网页顶部+自身高的一半(实现未滚到底就开始加载)
			var scrollTop=document.documentElement.scrollTop||document.body.scrollTop;//注意解决兼容性
    		var documentH=document.documentElement.clientHeight;//页面高度
    		return (lastPinH<scrollTop+documentH)?true:false;//到达指定高度后 返回true，触发waterfall()函数
		}
	</script>
</head>
<body>
<div id="blessing"><p>你是一只迷人的小妖精，虽然你脸大，但是你胸小啊。希望我最爱的聪慧的美丽动人的逗逼的重情重义的让我为你迷恋一生的就算我做错什么也会原谅我的羊生日快乐，先原谅我没有在农历那天祝你生日快乐。每一次跟你在一起都有说不完的话，洗不完的鸳鸯浴，笑不完的互相调侃，一想到我们30岁的约定，我就后背发凉，浑身冒冷汗，你还是赶嘛嫁出去吧，省得我天天还得给你喂草还挤不出羊奶！我会爱你一辈子，如果你老了，病了，走不动了，我就去照顾你，省得麻烦儿女，他们也有自己的儿女和事业。如果有来世，我要做男人，娶一个你这样的女人！</p></div>
<div id="main">
	<div class="pic">
		<div class="box">
			<img src="./images/1.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/2.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/3.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/4.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/5.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/6.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/7.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/8.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/9.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/10.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/11.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/12.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/13.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/14.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/15.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/16.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/17.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/18.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/19.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/20.jpg"/>
		</div>
	</div>
	<div class="pic">
		<div class="box">
			<img src="./images/21.jpg"/>
		</div>
	</div>
</div>
	
</body>
</html>